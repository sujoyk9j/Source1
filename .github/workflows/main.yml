        - name: Deploy to Target1
        # The configuration and cloning steps can remain in a single block
        run: |
          # 1. Configure Git credentials using the secret token
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # The deployment URL, authenticated with the secret token
          DEPLOY_URL="https://x-access-token:${{ secrets.TARGET_REPO_TOKEN }}@github.com/${{ github.repository_owner }}/${{ env.TARGET_REPO_NAME }}.git"
          
          # 2. Clone Target1 into a temporary directory
          TEMP_DIR="${{ runner.temp }}/target-clone"
          git clone --single-branch --branch ${{ env.TARGET_BRANCH }} ${DEPLOY_URL} ${TEMP_DIR} || \
          (echo "Branch ${{ env.TARGET_BRANCH }} not found, cloning default branch." && git clone ${DEPLOY_URL} ${TEMP_DIR})
          
          # 3. Clean up the target directory (optional, but good for static sites)
          # We only keep the .git folder
          find ${TEMP_DIR} -maxdepth 1 ! -name ".git" ! -name "." -exec rm -rf {} +
          
          # 4. Copy new artifacts from Source1 to the Target1 clone
          rsync -av --exclude='.git' ${{ env.ARTIFACT_PATH }}/ ${TEMP_DIR}/
          
        # END OF FIRST RUN BLOCK
        
      - name: ðŸ’¾ Commit and Push to Target1
        # ðŸš¨ NEW: Set the working directory for this step
        working-directory: ${{ runner.temp }}/target-clone
        run: |
          # The authenticated URL must be reconstructed here if needed, 
          # but we only need the token for the final push.
          DEPLOY_URL="https://x-access-token:${{ secrets.TARGET_REPO_TOKEN }}@github.com/${{ github.repository_owner }}/${{ env.TARGET_REPO_NAME }}.git"
          
          # 1. Add changes
          git add .
          
          # 2. Only commit if there are changes
          if git diff --cached --exit-code; then
              echo "No changes detected. Skipping commit and push."
          else
              # 3. Commit changes
              git commit -m "CICD Deploy from Source1 (Run ${{ github.run_number }})"
              
              # 4. Push changes
              echo "Pushing changes to ${{ env.TARGET_REPO_NAME }}/${{ env.TARGET_BRANCH }}"
              git push ${DEPLOY_URL} ${{ env.TARGET_BRANCH }}
          fi
